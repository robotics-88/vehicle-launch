<launch>
    <arg name="save_pcd" default="false"/>
    <arg name="bag_dir" default="/home/$(env USER)/src/bags"/>
    <arg name="flight_dir" default="$(var bag_dir)/oregon/day3/2025-03-06_20-14-19/flight_2025-03-06_15-17-13"/>
    <arg name="video_name" default="birdstart1.mp4"/>
    <arg name="camera_name" default="gopro"/>

    <include file="$(find-pkg-share vehicle_launch)/launch/decco.launch">
        <arg name="offline" value="true"/>
        <arg name="tilted_lidar" value="true"/>
        <arg name="save_pcd" value="$(var save_pcd)"/>
    </include>
    
    <include file="$(find-pkg-share mp4_to_ros2)/launch/mp4.launch">
        <arg name="frame_id" value="mp4"/>
        <arg name="camera_info_file" value="$(find-pkg-share vehicle_launch)/config/$(var camera_name)_info.yaml"/>
        <arg name="video_file" value="$(var flight_dir)/$(var video_name)"/>
    </include>

    <node name="gopro_static_tf" pkg="tf2_ros" exec="static_transform_publisher" args="0.13 0.021 .085 0 0 0 base_link mp4"/>
    <node name="gopro_optical_static_tf" pkg="tf2_ros" exec="static_transform_publisher" args="0 0 0 -1.57079633 0 -1.57079633 mp4 mp4_optical"/>

    <include file="$(find-pkg-share image_proc)/launch/image_proc.launch.py">
        <arg name="namespace" value="mp4"/>
    </include>

    <executable cmd="ros2 bag play $(var flight_dir)/bag/bag_0.mcap --topics /livox/imu /livox/lidar /mavros/imu/data /mavros/global_position/global" output="screen" />

</launch>
